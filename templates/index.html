<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trippy Wizard</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-purple-100">
    <div id="root"></div>
    
    <script type="text/babel">
        function App() {
            const [step, setStep] = React.useState(0);
            const [answers, setAnswers] = React.useState({});
            const [forecast, setForecast] = React.useState(null);
            const [loading, setLoading] = React.useState(false);

            const questions = [
                {
                    id: "birthday",
                    question: "When were you born?",
                    type: "date"
                },
                {
                    id: "environment",
                    question: "Which environment calls to your soul?",
                    options: ["Woods", "Desert", "Ocean", "Mountains"]
                },
                {
                    id: "time",
                    question: "When do you feel most alive?",
                    options: ["Dawn", "Midday", "Dusk", "Midnight"]
                },
                {
                    id: "element",
                    question: "Which element resonates with you?",
                    options: ["Fire", "Water", "Earth", "Air"]
                },
                {
                    id: "creature",
                    question: "Which mythical creature would be your companion?",
                    options: ["Dragon", "Phoenix", "Unicorn", "Griffin"]
                },
                {
                    id: "color",
                    question: "What color represents your energy?",
                    options: ["Deep Blue", "Forest Green", "Royal Purple", "Golden Yellow"]
                },
                {
                    id: "season",
                    question: "Which season mirrors your spirit?",
                    options: ["Spring", "Summer", "Autumn", "Winter"]
                },
                {
                    id: "journey",
                    question: "What type of journey calls to you?",
                    options: ["Inner Discovery", "Creative Expression", "Knowledge Seeking", "Adventure"]
                }
            ];

            const handleAnswer = (answer) => {
                setAnswers({...answers, [questions[step].id]: answer});
                if (step < questions.length - 1) {
                    setStep(step + 1);
                } else {
                    getForecast();
                }
            };

            const getForecast = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/forecast', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(answers)
                    });
                    const data = await response.json();
                    setForecast(data.forecast);
                } catch (error) {
                    console.error('Error:', error);
                }
                setLoading(false);
            };

            const renderQuestion = () => {
                const currentQuestion = questions[step];
                return (
                    <div className="space-y-4">
                        <h2 className="text-2xl font-bold text-purple-800 mb-4">
                            {currentQuestion.question}
                        </h2>
                        {currentQuestion.type === 'date' ? (
                            <input
                                type="date"
                                onChange={(e) => handleAnswer(e.target.value)}
                                className="p-2 border rounded-lg"
                            />
                        ) : (
                            <div className="grid grid-cols-2 gap-4">
                                {currentQuestion.options.map((option) => (
                                    <button
                                        key={option}
                                        onClick={() => handleAnswer(option)}
                                        className="p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                    >
                                        {option}
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen p-8">
                    <div className="max-w-2xl mx-auto bg-white rounded-xl shadow-xl p-8">
                        <h1 className="text-4xl font-bold text-center text-purple-900 mb-8">
                            ðŸ”® Trippy Wizard
                        </h1>
                        
                        {!forecast ? (
                            <>
                                <div className="mb-4 flex justify-between text-purple-600">
                                    <span>Question {step + 1} of {questions.length}</span>
                                    <span>{Math.round((step / questions.length) * 100)}% Complete</span>
                                </div>
                                <div className="w-full bg-purple-200 rounded-full h-2 mb-8">
                                    <div
                                        className="bg-purple-600 rounded-full h-2 transition-all duration-500"
                                        style={{width: `${(step / questions.length) * 100}%`}}
                                    ></div>
                                </div>
                                {renderQuestion()}
                            </>
                        ) : (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-purple-800 mb-4">
                                    Your 3-Month Mystical Forecast
                                </h2>
                                <div className="prose max-w-none">
                                    {forecast.split('\n\n').map((paragraph, index) => (
                                        <p key={index} className="text-gray-700 leading-relaxed">
                                            {paragraph}
                                        </p>
                                    ))}
                                </div>
                                <button
                                    onClick={() => {
                                        setStep(0);
                                        setAnswers({});
                                        setForecast(null);
                                    }}
                                    className="mt-6 w-full p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Start New Reading
                                </button>
                            </div>
                        )}
                        
                        {loading && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                <div className="bg-white p-8 rounded-xl">
                                    <p className="text-xl text-purple-800">ðŸ”® Consulting the cosmic forces...</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
